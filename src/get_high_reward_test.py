#!/usr/bin/env python3
# -*- coding:utf-8 -*-
"""
@Auther:Evans_WP
@Contact:WenPeng19943251019@163.com
@Time:2025/8/8 15:23
@File:get_high_reward_test.py
@Desc:****************
"""
from data_fraction import get_high_reward

if __name__ == '__main__':
    test_data = {'action': {'(3, 15)': 0.1362866759300232, '(3, 16)': 0.09639879316091537, '(3, 17)': 0.6527003645896912, '(3, 18)': 0.11461420357227325},
                 'choice_key': '(3, 17)',
                 'edges': [{'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 1.1591911315917969, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.999565978298915, 'loss': 0.0, 'pkt_drop': 0, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 5, 'target': 1, 'used_bw': 0.00043402170108505436},
                           {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.9997479873993695, 'loss': 0.5659309564233164, 'pkt_drop': 1, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 5, 'target': 2, 'used_bw': 0.0002520126006300316},
                           {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 2.0030736923217773, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.99966567995821, 'loss': 0.0, 'pkt_drop': 0, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 5, 'target': 11, 'used_bw': 0.0003343200417900055},
                           {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0.14197826385498047, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.997568532316756, 'loss': 0.006853743400416251, 'pkt_drop': 1, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 12, 'target': 15, 'used_bw': 0.0024314676832438227},
                           {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.999746076529712, 'loss': 8.851187550556877e-05, 'pkt_drop': 1, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 12, 'target': 10, 'used_bw': 0.00025392347028742763},
                           {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0.6780624389648438, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 3.912921052631583, 'loss': 0.0066246004537851315, 'pkt_drop': 1, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 12, 'target': 16, 'used_bw': 2.087078947368417},
                           {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0.9355545043945312, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 3.9529911627101075, 'loss': 0.0006736348200940326, 'pkt_drop': 1, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 12, 'target': 9, 'used_bw': 2.0470088372898925}, {'(3, 15)': 1, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 4.181552498694061, 'loss': 7.633180383351232, 'pkt_drop': 50, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 15, 'target': 11, 'used_bw': 1.8184475013059391}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0.05638599395751953, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.9997509512279485, 'loss': 0.0, 'pkt_drop': 0, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 2, 'target': 6, 'used_bw': 0.00024904877205119167}, {'(3, 15)': 0, '(3, 16)': 1, '(3, 17)': 1, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 3.30713676110529, 'loss': 0.367163114226298, 'pkt_drop': 51, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 10, 'target': 13, 'used_bw': 2.69286323889471}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 1, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 4.714649043478261, 'loss': 0.0, 'pkt_drop': 0, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 10, 'target': 8, 'used_bw': 1.285350956521739}, {'(3, 15)': 0, '(3, 16)': 1, '(3, 17)': 1, '(3, 18)': 1, 'delay': 40.874481201171875, 'distance': 1.0, 'forward_queue_bytes': 42392, 'forward_queue_pkts': 14, 'free_bw': 0.07212136006970216, 'loss': 0.07312051981947634, 'pkt_drop': 38, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 10, 'target': 7, 'used_bw': 5.927878639930298}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 4.207276144075174, 'loss': 0.008553428912847922, 'pkt_drop': 1, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 10, 'target': 14, 'used_bw': 1.792723855924826}, {'(3, 15)': 0, '(3, 16)': 1, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.530521161245192, 'loss': 7.044020446757917, 'pkt_drop': 17, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 16, 'target': 13, 'used_bw': 0.4694788387548079}, {'(3, 15)': 1, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.999642349679432, 'loss': 0.0, 'pkt_drop': 0, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 9, 'target': 7, 'used_bw': 0.0003576503205683581}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0.3452301025390625, 'distance': 1.0, 'forward_queue_bytes': 6056, 'forward_queue_pkts': 2, 'free_bw': 1.7679001906082252, 'loss': 0.7295311290229151, 'pkt_drop': 28, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 9, 'target': 6, 'used_bw': 4.232099809391775}, {'(3, 15)': 1, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0.44357776641845703, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 4.181636078704508, 'loss': 13.581269514972202, 'pkt_drop': 99, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 9, 'target': 11, 'used_bw': 1.8183639212954918}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 1, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 3.776181881776852, 'loss': 0.0626131424516974, 'pkt_drop': 9, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 17, 'target': 13, 'used_bw': 2.223818118223148}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 1, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 4.686580128762836, 'loss': 0.0, 'pkt_drop': 0, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 14, 'target': 8, 'used_bw': 1.3134198712371639}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 1, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 2.8940929180442048, 'loss': 0.018795046961843073, 'pkt_drop': 3, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 14, 'target': 18, 'used_bw': 3.1059070819557952}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0.12981891632080078, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.999666897987509, 'loss': 0.0, 'pkt_drop': 0, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 8, 'target': 4, 'used_bw': 0.0003331020124913249}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.999666897987509, 'loss': 0.0, 'pkt_drop': 0, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 4, 'target': 7, 'used_bw': 0.0003331020124913249}, {'(3, 15)': 1, '(3, 16)': 1, '(3, 17)': 1, '(3, 18)': 1, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 4.059525021796004, 'loss': 0.14971260235037576, 'pkt_drop': 80, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 7, 'target': 3, 'used_bw': 5.940474978203996}, {'(3, 15)': 0, '(3, 16)': 0, '(3, 17)': 0, '(3, 18)': 0, 'delay': 0, 'distance': 1.0, 'forward_queue_bytes': 0, 'forward_queue_pkts': 0, 'free_bw': 5.777736423382941, 'loss': 0.27201192171517746, 'pkt_drop': 10, 'pkt_err': 0.0, 'reverse_queue_bytes': 0, 'reverse_queue_pkts': 0, 'source': 3, 'target': 6, 'used_bw': 4.222263576617059}], 'nodes': [{'id': 5}, {'id': 1}, {'id': 12}, {'id': 15}, {'id': 2}, {'id': 10}, {'id': 16}, {'id': 9}, {'id': 11}, {'id': 17}, {'id': 13}, {'id': 14}, {'id': 8}, {'id': 4}, {'id': 7}, {'id': 3}, {'id': 6}, {'id': 18}], 'timestamp': '2025-08-08-11-50-34'}
    act_pro = [0.4686954617500305, 0.06395765393972397, 0.35309258103370667, 0.11425423622131348]
    high_reward = get_high_reward(test_data,act_pro)
    print(high_reward)
    loss_test_list = [e['loss'] < 1 for e in test_data['edges']]  # 检查loss>1的数据异常
    print(f'loss_test_list:{loss_test_list},result:{all(loss_test_list)}')
